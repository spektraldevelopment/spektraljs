/**
 * Spektraljs
 *
 * Copyright (c) 2013 spektraldevelopment.com, David Boyle.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 **//*global ActiveXObject: false *//*jslint plusplus: true, unparam: true */(function(e){"use strict";var t={},n=e.location,r=e.document,i=r.documentElement,s=!1,o;o=["click","dblclick","mousedown","mousemove","mouseup","mouseover","mouseout"];t.debug=function(){s=!0};t.about=function(){var e,n;s?e="debug":e="release";n="Spektral.js V.01 mode: "+e;t.log(n);return n};t.attachEventListener=function(e,n,r){var i;if(e.addEventListener)e.addEventListener(n,r,!1);else if(e.attachEvent){n="on"+n;e.attachEvent(n,r)}else e["on"+n]=r;for(i=0;i<o.length;i++)if(n===o[i]){t.useHandCursor(e);break}};t.detachEventListener=function(e,n,r){var i;if(e.removeEventListener)e.removeEventListener(n,r,!1);else if(e.detachEvent){n="on"+n;e.detachEvent(n,r)}else e["on"+n]=null;for(i=0;i<o.length;i++)if(n===o[i]){t.useDefaultCursor(e);break}};t.getKey=function(e){if(e===38)return"UP";if(e===40)return"DOWN";if(e===37)return"LEFT";if(e===39)return"RIGHT";if(e===13)return"ENTER"};t.cancelEvent=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1};t.cancelPropogation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0};t.useHandCursor=function(e,n){n=n||"pointer";t.createSetAttribute(e,"style","cursor: "+n)};t.useDefaultCursor=function(e){t.createSetAttribute(e,"style","cursor: default")};t.getComputedStyle=function(e,t){var n=null;e.currentStyle!==undefined?n=e.currentStyle:n=r.defaultView.getComputedStyle(e,null);return n[t]};t.getViewportSize=function(){var t,n;e.innerWidth?t=e.innerWidth:r.body&&r.body.offsetWidth?t=r.body.offsetWidth:t=0;e.innerHeight?n=e.innerHeight:r.body&&r.body.offsetHeight?n=r.body.offsetHeight:n=0;return{width:t,height:n}};t.isMatch=function(e,t){var n;e===t?n=!0:n=!1;return n};t.loadJSON=function(e,n,r){r=r||!0;var i=t.getType(e);i==="string"?t.loadFile(e,n,r):t.throwError("loadJSON: Invalid source type: "+i+". Source must be string or external json file.")};t.loadXML=function(e,n,r){r=r||!0;var i=t.getType(e);i==="string"?t.loadFile(e,n,r):t.throwError("loadXML: Invalid source type: "+i+". Source must be string or external json file.")};t.loadFile=function(e,n,r){function o(){if(s.readyState<4)return;if(s.status!==200)return;if(s.readyState===4){var e;i==="json"?e=JSON.parse(s.responseText):i==="xml"?e=s.responseXML:e=s.responseText;n(e)}}function u(e){t.throwError("loadError: There was a load error: "+e)}r=r||!0;var i=t.getExtension(e),s=t.getXHR();i==="json"&&s.overrideMimeType("application/json");t.attachEventListener(s,"readystatechange",o);t.attachEventListener(s,"error",u);s.open("GET",e,r);s.send()};t.getXHR=function(){var n,r,i;if(e.XMLHttpRequest)n=new XMLHttpRequest;else{r=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp","Microsoft.XMLHTTP"];for(i=0;i<r.length;i++)try{n=new ActiveXObject(r[i]);return n}catch(s){t.throwError("loadFile: Couldn't find the proper XMLHttp version.")}}return n};t.xmlToJSON=function(e,n,r){n=n||e.firstChild.nodeName;r=r||0;var i=e.getElementsByTagName(n)[r],s,o,u={};for(s=i.firstChild;s!==null;s=s.nextSibling){o=t.getType(s);o==="text"?t.log("Going to handle text in here someday."):o==="element"&&(u[s.tagName]=t.createObject(s.childNodes))}return u};t.createObject=function(e){var n,r,i=[],s,o,u,a,f,l,c;for(l=0;l<e.length;l++){n=e[l];r=t.getType(n);if(r==="element"){a=n.hasChildNodes();f=n.childNodes.length;s={};o=n.attributes;u=o.length;if(u>=1)for(c=0;c<o.length;c++)s[o.item(c).name]=o.item(c).value;s[n.tagName]=t.getTextContent(n);a&&f>1&&(s[n.tagName]=t.createObject(n.childNodes));i.push(s)}}return i};t.query=function(e){};t.getElement=function(e,n){var i=t.isHTMLElement(e),s=t.isHTMLID(e),o=t.isHTMLName(e),u;i===!0?n===undefined?u=r.getElementsByTagName(e)[0]:u=r.getElementsByTagName(e)[n]:s===!0?u=r.getElementById(e):o===!0?n===undefined?u=r.getElementsByName(e)[0]:u=r.getElementsByName(e)[n]:t.throwError("Element Not Found. Ensure you are calling a valid name or element.");return u};t.isHTMLElement=function(e){var n=t.listElements(),r=null,i;for(i=0;i<n.length;i++)if(e===n[i]){r=!0;return r}if(r===null)return!1};t.isHTMLID=function(e){var n=t.listElements("id"),r=null,i;for(i=0;i<n.length;i++)if(e===n[i]){r=!0;return r}if(r===null)return!1};t.isHTMLName=function(e){var n=t.listElements("name"),r=null,i;for(i=0;i<n.length;i++)if(e===n[i]){r=!0;return r}if(r===null)return!1};t.createNewElement=function(e,n,i){var s,o,u,a=t.getElement("body"),f;t.log("createNewElement: parent type: "+t.getType(i));s=n||null;t.getType(i)==="string"?o=t.getElement(i)||null:o=i||null;u=r.createElement(e);if(o===null)a.appendChild(u);else if(o!==null)o.appendChild(u);else{f="createElement: could not find parent target node.";o!==null&&(f+=" parentNode: "+o);t.throwError(f)}s!==null&&(u.id=s);return u};t.moveToAfter=function(e,t){var n=e.parentNode;n.insertBefore(e,t.nextSibling)};t.moveToBefore=function(e,t){var n=e.parentNode;n.insertBefore(e,t)};t.removeElement=function(e){};t.createSetAttribute=function(e,t,n){e.setAttribute(t,n)};t.retrieveAttribute=function(e,t,n){};t.destroyAttribute=function(e,t,n){};t.getTextContent=function(e){var t=e.textContent;return t!==undefined?t:e.innerText};t.getNodeAttributes=function(e){var t=e.attributes,n={},r;if(t.length>=1)for(r=0;r<t.length;r++)n[t.item(r).name]=t.item(r).value;return n};t.showElement=function(e){};t.hideElement=function(e){};t.getNodes=function(e){};t.listNodeAttributes=function(e){var n=[],r;for(r in e){n.push(r);t.log("Node: "+e.nodeName+" Attribute: "+r)}return n};t.isObjectEmpty=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0};t.detectCharacter=function(e,t){};t.getInfo=function(e){var t;try{t=JSON.stringify(e)}catch(n){}return t};t.stripBrackets=function(e){var t;try{t=e.match(/\[(.*?)\]/)[1]}catch(n){}try{t=e.match(/\((.*?)\)/)[1]}catch(n){}try{t=e.match(/\{(.*?)\}/)[1]}catch(n){}return t};t.convertCase=function(e,t){t=t||"lower";if(t==="lower")return e.toLowerCase();if(t==="upper")return e.toUpperCase()};t.splitString=function(e,t){return e.split(t)};t.listElements=function(e){e=e||null;var n=r.getElementsByTagName("*"),i=[],s,o;for(o=0;o<n.length;o++)if(e==="id"){s=n[o].id;s!==""&&i.push(s)}else if(e==="name"){s=n[o].name;s!==""&&i.push(s)}else{s=t.convertCase(n[o].nodeName);i.push(s)}return i};t.listArrayElements=function(e){var n=t.getType(e),r;if(n!=="array"&&n!=="nodelist")t.throwError("listArrayElements: You must pass either an array or nodelist to this function.");else for(r=0;r<e.length;r++)n==="nodelist"?t.log("NodeList: listArrayElement: item"+r+": "+e[r].nodeName):n==="array"&&t.log("Array: listArrayElement: item"+r+": "+e[r])};t.listChildNodes=function(e){var n=e.childNodes,r;t.log("Children of: "+e.nodeName);for(r=0;r<n.length;r++)t.log("Child: "+n[r])};t.getType=function(e){return{}.toString.call(e).match(/\s([a-zA-Z]+)/)[1].toLowerCase()};t.validateParams=function(e){var n=t.getType(e);n!=="object"&&t.throwError("validateParams: params must always be an object. Currently it is an "+e+".")};t.getExtension=function(e){var n=t.getType(e);e===undefined?t.throwError("getExtension: file is undefined. Did you pass a file name to this function?"):n!=="string"&&t.throwError("getExtension: file needs to be string.");return e.split(".").pop()};t.throwError=function(e){throw new Error("Spektraljs: "+e)};t.log=function(e){s&&console.log("Spektraljs: "+e)};e.Spektral=t})(window);