/**
 * Spektraljs
 *
 * Copyright (c) 2013 spektraldevelopment.com, David Boyle.
 *
 * Distributed under the terms of the MIT license.
 * http://www.opensource.org/licenses/mit-license.html
 *
 * This notice shall be included in all copies or substantial portions of the Software.
 **//*global ActiveXObject: false *//*jslint plusplus: true, unparam: true */(function(e){"use strict";var t={},n=e.location,r=e.document,i=r.documentElement,s=!1,o=["click","dblclick","mousedown","mousemove","mouseup","mouseover","mouseout"];t.debug=function(){s=!0};t.about=function(){var e,n;s?e="debug":e="release";n="Spektral.js V.01 mode: "+e;t.log(n);return n};t.attachEventListener=function(e,n,r){var i,s=t.getType(e);s==="string"&&(e=t.getElement(e));if(e.addEventListener)e.addEventListener(n,r,!1);else if(e.attachEvent){n="on"+n;e.attachEvent(n,r)}else e["on"+n]=r;for(i=0;i<o.length;i++)if(n===o[i]&&s!=="global"){t.useHandCursor(e);break}};t.detachEventListener=function(e,n,r){var i,s=t.getType(e);s==="string"&&(e=t.getElement(e));if(e.removeEventListener)e.removeEventListener(n,r,!1);else if(e.detachEvent){n="on"+n;e.detachEvent(n,r)}else e["on"+n]=null;for(i=0;i<o.length;i++)if(n===o[i]&&s!=="global"){t.useDefaultCursor(e);break}};t.getKey=function(e){var t;e===38&&(t="UP");e===40&&(t="DOWN");e===37&&(t="LEFT");e===39&&(t="RIGHT");e===13&&(t="ENTER");return t};t.createEvent=function(e,t,n,r){t=t||null;n=n||!0;r=r||!0;var i,s;t===null?i=new Event(e):i=new CustomEvent(e,{detail:t,bubbles:n,cancelable:r});return i};t.cancelEvent=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1};t.cancelPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0};t.getTarget=function(e){return e.relatedTarget||e.fromElement||e.target};t.useHandCursor=function(e,n){n=n||"pointer";var r="cursor:"+n,i=t.getType(e);i!=="input"&&t.appendStyle(e,r)};t.useDefaultCursor=function(e){t.appendStyle(e,"cursor: default")};t.getMousePos=function(e){e===undefined&&t.throwError("getMousePos: Event is undefined. If not targeting a specific element, use [window].");var n={},s=0,o=0,u=0,a=0,f=0,l=0,c=t.getTarget(e),h=t.getPos(c).x,p=t.getPos(c).y;if(e.pageX){s=e.pageX;o=e.pageY}else if(e.clientX){if(i.scrollLeft){u=i.scrollLeft;a=i.scrollTop}else if(r.body){u=r.body.scrollLeft;a=r.body.scrollTop}s=e.clientX+u;o=e.clientY+a}else t.throwError("getMousePos: pageX/Y and clientX/Y could not be found.");n.x=t.roundNum(s);n.y=t.roundNum(o);n.mouseX=t.roundNum(s-h);n.mouseY=t.roundNum(o-p);return n};t.getViewportSize=function(){var t,n;e.innerWidth?t=e.innerWidth:r.body&&r.body.offsetWidth?t=r.body.offsetWidth:t=0;e.innerHeight?n=e.innerHeight:r.body&&r.body.offsetHeight?n=r.body.offsetHeight:n=0;return{width:t,height:n}};t.isMatch=function(e,t){var n=!1;e===t&&(n=!0);return n};t.loadJSON=function(e,n,r){r=r||!0;var i=t.getType(e);i==="string"?t.loadFile(e,n,r):t.throwError("loadJSON: Invalid source type: "+i+". Source must be string or external json file.")};t.loadXML=function(e,n,r){r=r||!0;var i=t.getType(e);i==="string"?t.loadFile(e,n,r):t.throwError("loadXML: Invalid source type: "+i+". Source must be string or external json file.")};t.loadFile=function(e,n,r){function o(){if(s.readyState<4)return;if(s.status!==200)return;if(s.readyState===4){var e;i==="json"?e=JSON.parse(s.responseText):i==="xml"?e=s.responseXML:e=s.responseText;n(e)}}function u(e){t.throwError("loadError: There was a load error: "+e)}r=r||!0;var i=t.getExtension(e),s=t.getXHR();i==="json"&&s.overrideMimeType("application/json");t.attachEventListener(s,"readystatechange",o);t.attachEventListener(s,"error",u);s.open("GET",e,r);s.send()};t.getXHR=function(){var n,r,i;if(e.XMLHttpRequest)n=new XMLHttpRequest;else{r=["MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp","Microsoft.XMLHTTP"];for(i=0;i<r.length;i++)try{n=new ActiveXObject(r[i]);return n}catch(s){t.throwError("loadFile: Couldn't find the proper XMLHttp version.")}}return n};t.xmlToJSON=function(e,n,r){n=n||e.firstChild.nodeName;r=r||0;var i=e.getElementsByTagName(n)[r],s,o,u={};for(s=i.firstChild;s!==null;s=s.nextSibling){o=t.getType(s);o==="text"?t.log("Going to handle text in here someday."):o==="element"&&(u[s.tagName]=t.createObject(s.childNodes))}return u};t.createObject=function(e){var n,r,i=[],s,o,u,a,f,l,c;for(l=0;l<e.length;l++){n=e[l];r=t.getType(n);if(r==="element"){a=n.hasChildNodes();f=n.childNodes.length;s={};o=n.attributes;u=o.length;if(u>=1)for(c=0;c<o.length;c+=1)s[o.item(c).name]=o.item(c).value;s[n.tagName]=t.getTextContent(n);a&&f>1&&(s[n.tagName]=t.createObject(n.childNodes));i.push(s)}}return i};t.query=function(e){var t,n;try{t=r.querySelectorAll(e);t.length<=1?n=t[0]:n=t}catch(i){}return n};t.getElement=function(e,n){var i=t.isHTMLElement(e),s=t.isHTMLID(e),o=t.isHTMLName(e),u,a,f;if(i===!0)n===undefined?u=r.getElementsByTagName(e)[0]:u=r.getElementsByTagName(e)[n];else if(s===!0)u=r.getElementById(e);else if(o===!0)n===undefined?u=r.getElementsByName(e)[0]:u=r.getElementsByName(e)[n];else{u=t.query(e);u===undefined&&t.throwError("Element Not Found. Ensure you are calling a valid name or element.")}a=t.getType(u);if(a==="nodelist"){t.log("getElement: More than one element was found.");t.listArrayElements(u)}return u};t.isHTMLElement=function(e){var n=t.listElements(),r=null,i;for(i=0;i<n.length;i++)if(e===n[i]){r=!0;break}r===null&&(r=!1);return r};t.isHTMLID=function(e){var n=t.listElements("id"),r=null,i;for(i=0;i<n.length;i++)if(e===n[i]){r=!0;break}r===null&&(r=!1);return r};t.isHTMLName=function(e){var n=t.listElements("name"),r=null,i;for(i=0;i<n.length;i++)if(e===n[i]){r=!0;break}r===null&&(r=!1);return r};t.createNewElement=function(e,n,i){var s,o,u,a=t.getElement("body"),f;s=n||null;t.getType(i)==="string"?o=t.getElement(i)||null:o=i||null;u=r.createElement(e);if(o===null)a.appendChild(u);else if(o!==null)o.appendChild(u);else{f="createElement: could not find parent target node.";o!==null&&(f+=" parentNode: "+o);t.throwError(f)}s!==null&&(u.id=s);return u};t.moveToAfter=function(e,t){var n=e.parentNode;n.insertBefore(e,t.nextSibling)};t.moveToBefore=function(e,t){var n=e.parentNode;n.insertBefore(e,t)};t.removeElement=function(e){try{e.remove()}catch(n){t.log("removeElement: .remove() was not available. Reverting to removeChild().");e.parentNode.removeChild(e)}};t.setStyle=function(e,n){var r=t.getType(n),i="",s;if(r==="string")i=n;else if(r==="array")for(s=0;s<n.length;s+=1)s!==n.length-1?i+=n[s]+"; ":i+=n[s]+";";else t.throwError("setStyle: Property must be a string or array.");t.createSetAttribute(e,"style",i)};t.getStyle=function(e,n){n=n||undefined;var i;if(n!==undefined)try{i=e.currentStyle[n]}catch(s){i=r.defaultView.getComputedStyle(e,null).getPropertyValue(n)}else try{i=t.getInlineStyle(e)}catch(s){t.throwError("getStyle: Could not get style.")}return i};t.appendStyle=function(e,n){var r=t.getInlineStyle(e),i="",s,o=!1,u,a=t.detectCharacter(n,";");a===!0&&t.throwError("appendStyle: Sorry, for now you can only append one value at a time. Don't include ; in your string.");if(r===!1)i+=n+"; ";else{u=t.splitString(n,":");for(s in r)if(s===u[0]){o=!0;i+=s+":"+u[1]+"; "}else i+=s+":"+r[s]+"; ";o===!1&&(i+=n+"; ")}t.setStyle(e,i)};t.clearStyle=function(e){t.destroyAttribute(e,"style")};t.getInlineStyle=function(e){var n=e.style.cssText,r,i,s,o,u,a={};if(n===""){a=!1;t.log("getInlineStyle: No inline style set.")}else{r=t.splitString(n,";");for(u=0;u<r.length;u+=1){i=t.splitString(r[u],":");s=i[0];o=i[1];a[s]=o}}return a};t.convertToCamel=function(e,n){n=n||"-";var r=t.splitString(e,n),i,s,o;i=r[0];for(o=0;o<r.length;o+=1)if(o!==0){s=r[o].charAt(0).toUpperCase()+r[o].slice(1);i+=s}return i};t.createSetAttribute=function(e,t,n){e.setAttribute(t,n)};t.retrieveAttribute=function(e,n){var r,i;r=e.getAttribute(n);if(r===null){i=t.getNodeAttributes(e);r=i[n];if(r===undefined){r=null;t.throwError("retrieveAttribute: Attribute does not exist. Are you calling its name correctly?")}}return r};t.destroyAttribute=function(e,n){if(e.hasAttribute(n)){e.removeAttribute(n);e.getAttribute(n)!==null?t.throwError("destroyElement: Attribute was unable to be removed for some reason."):t.log("Attribute destroyed.")}};t.getTextContent=function(e){var t=e.textContent;t==="undefined"&&(t=e.innerText);return t};t.getNodeAttributes=function(e){var t=e.attributes,n={},r;if(t.length>=1)for(r=0;r<t.length;r+=1)n[t.item(r).nodeName]=t.item(r).value;return n};t.checkForAttribute=function(e,t){};t.showElement=function(e,n){n=n||"block";var r=t.getStyle(e,"visibility"),i=t.getStyle(e,"display"),s="display:"+n;if(r==="visible"&&i!=="none")t.log(e+" is already visible.");else{t.appendStyle(e,s);t.appendStyle(e,"visibility:visible")}};t.hideElement=function(e,n){n=n||!1;var r=t.getStyle(e,"visibility"),i=t.getStyle(e,"display");r==="hidden"||i==="none"?t.log(e+" is already hidden."):n===!0?t.appendStyle(e,"display:none"):t.appendStyle(e,"visibility:hidden")};t.toggleVisibility=function(e){var n=t.getStyle(e,"visibility"),r=t.getStyle(e,"display");r==="none"?t.toggleDisplay(e):n==="visible"?t.appendStyle(e,"visibility:hidden"):t.appendStyle(e,"visibility:visible")};t.toggleDisplay=function(e,n){n=n||"block";var r=t.getStyle(e,"display"),i="display:"+n,s=t.getStyle(e,"visibility");if(s==="hidden")t.toggleVisibility(e);else if(r==="block"||r==="inline"||r==="inline-block"||r==="inherit"){t.appendStyle(e,"display:none");t.log("toggleDisplay: Visible, hiding.")}else{t.appendStyle(e,i);t.log("toggleDisplay: Hiding, showing: "+i)}};t.listNodeAttributes=function(e){var n=[],r;for(r in e)if(e.hasOwnProperty(r)){n.push(r);t.log("Node: "+e.nodeName+" Attribute: "+r)}return n};t.roundNum=function(e,t){t=t||"regular";var n=0;t==="regular"?n=Math.round(e):t==="up"?n=Math.ceil(e):t==="down"&&(n=Math.floor(e));return n};t.getPos=function(e){var t={},n;n=e.getBoundingClientRect();t.x=n.left;t.y=n.top;t.left=n.left;t.top=n.top;t.right=n.right;t.bottom=n.bottom;return t};t.isObjectEmpty=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0};t.detectCharacter=function(e,t){var n=!1,r=e.match(t);r!==null&&(n=!0);return n};t.getInfo=function(e){var t;try{t=JSON.stringify(e)}catch(n){}return t};t.stripBrackets=function(e){var t;try{t=e.match(/\[(.*?)\]/)[1]}catch(n){}try{t=e.match(/\((.*?)\)/)[1]}catch(n){}try{t=e.match(/\{(.*?)\}/)[1]}catch(n){}return t};t.convertCase=function(e,t){t=t||"lower";var n;t==="lower"?n=e.toLowerCase():t==="upper"&&(n=e.toUpperCase());return n};t.splitString=function(e,n){var r=[],i=e.split(n),s,o=t.detectCharacter(e,n),u;o===!1&&t.throwError("splitString: Could not split string because character ["+n+"] was not in string.");for(s=0;s<i.length;s+=1)if(i[s]!==""){u=t.stripWhiteSpace(i[s]);r.push(u)}return r};t.stripWhiteSpace=function(e,t){t=t||!1;var n;t!==!1?n=e.replace(/\s+/g,""):n=e.replace(/(^\s+|\s+$)/g,"");return n};t.listElements=function(e){e=e||null;var n=r.getElementsByTagName("*"),i=[],s,o;for(o=0;o<n.length;o+=1)if(e==="id"){s=n[o].id;s!==""&&i.push(s)}else if(e==="name"){s=n[o].name;s!==""&&i.push(s)}else{s=t.convertCase(n[o].nodeName);i.push(s)}return i};t.listArrayElements=function(e){var n=t.getType(e),r;if(n!=="array"&&n!=="nodelist"&&n!=="namednodemap")t.throwError("listArrayElements: You must pass either an array or nodelist to this function.");else for(r=0;r<e.length;r+=1)n==="nodelist"?t.log("NodeList: listArrayElement: item"+r+": "+e[r].nodeName):n==="array"?t.log("Array: listArrayElement: item"+r+": "+e[r]):n==="namednodemap"&&t.log("NamedNodeMap: listArrayElement: item"+r+": "+e[r].nodeName)};t.listChildNodes=function(e){var n=e.childNodes,r;t.log("Children of: "+e.nodeName);for(r=0;r<n.length;r+=1)t.log("Child: "+n[r])};t.getElementIdentifiers=function(e){var n={},r;r=e.nodeName;n.id=e.id;n.name=e.name;n["class"]=e.className;n.nodeName=t.convertCase(r);return n};t.getType=function(e){var t;e.nodeName!==undefined?t=e.nodeName:t={}.toString.call(e).match(/\s([a-zA-Z]+)/)[1];t=t.toLowerCase();return t};t.validateParams=function(e){var n=t.getType(e);n!=="object"&&t.throwError("validateParams: params must always be an object. Currently it is an "+e+".")};t.getExtension=function(e){var n=t.getType(e);e===undefined?t.throwError("getExtension: file is undefined. Did you pass a file name to this function?"):n!=="string"&&t.throwError("getExtension: file needs to be string.");return e.split(".").pop()};t.throwError=function(e){throw new Error("Spektraljs: "+e)};t.log=function(e){s&&console.log("Spektraljs: "+e)};e.Spektral=t})(window);